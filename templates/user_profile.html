{% extends "base.html" %}
{% block title %}{{ user.name }} - Hồ sơ{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-8">
    <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
        <!-- Header hồ sơ -->
        <div class="bg-gradient-to-r from-pink-400 to-purple-600 p-8 text-white">
            <div class="flex flex-col md:flex-row items-center gap-8">
                <img src="{{ url_for('static', filename=user.avatar or 'images/default-avatar.png') }}"
                    class="w-32 h-32 rounded-full ring-8 ring-white shadow-2xl object-cover">

                <div class="text-center md:text-left flex-1">
                    <h1 class="text-4xl font-bold mb-3">{{ user.name }}</h1>

                    {% if user.role != 'admin' %}
                    <div class="flex items-center justify-center md:justify-start gap-3 mb-4">
                        <i class="fas fa-medal text-3xl
                            {% if 'Ứng viên Chuyên gia' in user.badge %}text-purple-200
                            {% elif 'Thành Viên Bạc' in user.badge %}text-gray-300
                            {% elif 'Thành Viên Đồng' in user.badge %}text-orange-300
                            {% else %}text-green-300{% endif %}"></i>
                        <div>
                            <p class="text-2xl font-bold">{{ user.badge }}</p>
                            <p class="text-lg opacity-90">{{ user.points }} điểm tích lũy</p>
                        </div>
                    </div>
                    {% endif %}

                    {% if user.is_verified_expert %}
                    <span
                        class="inline-block bg-white text-purple-700 px-6 py-3 rounded-full text-lg font-bold shadow-lg">
                        <i class="fas fa-stethoscope mr-2"></i> Chuyên gia xác thực
                    </span>
                    {% endif %}
                </div>

                <!-- Nút hành động (kết bạn / nhắn tin) -->
                {% if current_user.is_authenticated and not is_own_profile %}
                <div class="flex flex-col gap-3 mt-6">
                    {% if friendship_status == 'friends' %}
                    <!-- ĐÃ LÀ BẠN BÈ → HIỆN NÚT NHẮN TIN -->
                    <a href="{{ url_for('chat', user_id=user.id) }}"
                        class="px-8 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-full font-bold hover:shadow-xl transition text-center">
                        <i class="fas fa-comment-dots mr-2"></i> Nhắn tin
                    </a>
                    {% else %}
                    <!-- CHƯA LÀ BẠN BÈ → HIỆN NÚT KẾT BẠN -->
                    <button onclick="handleFriendAction('{{ user.id }}', 'add_friend', this)"
                        class="px-8 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-full font-bold hover:shadow-xl transition w-full">
                        <i class="fas fa-user-plus mr-2"></i> Kết bạn
                    </button>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Thông tin cá nhân -->
        <div class="p-8">
            <a href="{{ url_for('home') }}" class="text-pink-600 hover:text-pink-700 font-medium mb-6 inline-block">
                ← Quay lại trang chủ
            </a>

            <div class="grid md:grid-cols-2 gap-8 mb-10">
                <!-- Thông tin gia đình -->
                <div class="bg-gray-50 rounded-2xl p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-home mr-2 text-pink-600"></i> Thông tin gia đình
                    </h3>
                    <div class="space-y-3 text-gray-700">
                        {% if user.children_count > 0 %}
                        <p><i class="fas fa-child text-pink-500 mr-2"></i>
                            <strong>{{ user.children_count }} con</strong>
                        </p>
                        {% if user.children_ages %}
                        <p><i class="fas fa-birthday-cake text-purple-500 mr-2"></i>
                            Độ tuổi: {{ user.children_ages }}
                        </p>
                        {% endif %}
                        {% else %}
                        <p class="italic text-gray-500">Chưa cập nhật số con</p>
                        {% endif %}
                    </div>
                </div>

                <!-- Giới thiệu bản thân -->
                <div class="bg-gray-50 rounded-2xl p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-pen text-purple-600 mr-2"></i> Giới thiệu
                    </h3>
                    {% if user.bio %}
                    <p class="text-gray-700 leading-relaxed">{{ user.bio }}</p>
                    {% else %}
                    <p class="italic text-gray-500">Chưa có giới thiệu</p>
                    {% endif %}
                </div>
            </div>

            <!-- Bài viết gần đây -->
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Bài viết gần đây ({{ posts|length }})</h2>

            {% if posts %}
            <div class="space-y-6">
                {% for post in posts %}
                <div class="border border-gray-200 rounded-2xl p-6 hover:shadow-lg transition">
                    <a href="{{ url_for('post_detail', post_id=post.id) }}" class="block">
                        <h3 class="text-xl font-bold text-gray-900 hover:text-pink-600 mb-2">
                            {{ post.title }}
                        </h3>
                        <p class="text-gray-600 line-clamp-3 mb-3">
                            {{ post.content | truncate(200) }}
                        </p>
                        <div class="flex items-center justify-between text-sm text-gray-500">
                            <span>{{ post.created_at | vietnam_time }}</span>
                            <div class="flex items-center gap-4">
                                <span><i class="fas fa-heart text-pink-600"></i> {{ post.likes }}</span>
                                <span><i class="fas fa-comment text-blue-600"></i> {{ post.comments_count }}</span>
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-12 bg-gray-50 rounded-2xl">
                <i class="fas fa-feather-alt text-6xl text-gray-300 mb-4"></i>
                <p class="text-xl text-gray-500">Chưa có bài viết nào</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}