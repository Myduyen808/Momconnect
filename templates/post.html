{% extends "base.html" %}
{% block title %}Đăng bài chia sẻ{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto p-6">
    <div class="bg-white rounded-3xl shadow-2xl p-8">
        <div class="flex items-center justify-between mb-8">
            <h1 class="text-3xl font-bold text-gray-900">Đăng bài chia sẻ</h1>
            <a href="{{ url_for('home') }}" class="text-pink-600 hover:text-pink-700 font-medium flex items-center gap-2">
                <i class="fas fa-arrow-left"></i> Quay lại
            </a>
        </div>

        <form method="POST" enctype="multipart/form-data" class="space-y-8">
            <div>
                <label class="block text-lg font-medium text-gray-700 mb-3">Tiêu đề bài viết</label>
                <input type="text" name="title" required maxlength="200"
                    class="w-full px-5 py-4 border border-gray-300 rounded-2xl focus:ring-4 focus:ring-pink-300 focus:border-pink-500 text-lg"
                    placeholder="Ví dụ: Bé nhà mình đã biết lật rồi, mẹ nào cũng vậy không?">
            </div>

            <div>
                <label class="block text-lg font-medium text-gray-700 mb-3">Nội dung chia sẻ</label>
                <textarea name="content" rows="8" required
                    class="w-full px-5 py-4 border border-gray-300 rounded-2xl focus:ring-4 focus:ring-pink-300 focus:border-pink-500 resize-none text-lg"
                    placeholder="Hãy kể câu chuyện của bạn..."></textarea>
            </div>

            <div>
                <label class="block text-lg font-medium text-gray-700 mb-3">Chủ đề</label>
                <select name="category" class="w-full px-5 py-4 border border-gray-300 rounded-2xl text-lg" required>
                    <option value="health">Sức khỏe</option>
                    <option value="nutrition">Dinh dưỡng</option>
                    <option value="story">Tâm sự</option>
                    <option value="tips">Mẹo hay</option>
                    <option value="other">Khác</option>
                </select>
            </div>

            <!-- ĐĂNG NHIỀU ẢNH + VIDEO -->
            <div>
                <label class="block text-lg font-medium text-gray-700 mb-4">
                    Ảnh & Video (tùy chọn - được đăng nhiều ảnh + 1 video)
                </label>
                
                <div class="border-2 border-dashed border-pink-300 rounded-2xl p-8 text-center hover:border-pink-500 transition">
                    <input type="file" name="media" multiple accept="image/*,video/*"
                        class="hidden" id="media-input" onchange="previewMedia(this)">
                    <label for="media-input" class="cursor-pointer">
                        <i class="fas fa-cloud-upload-alt text-6xl text-pink-400 mb-4"></i>
                        <p class="text-xl text-gray-600 font-medium">Click để chọn ảnh hoặc video</p>
                        <p class="text-sm text-gray-500 mt-2">Hỗ trợ nhiều ảnh + 1 video (MP4)</p>
                    </label>
                </div>

                <!-- Preview media -->
                <div id="media-preview" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-6"></div>
            </div>

            <div class="flex gap-6 pt-6">
                <button type="submit"
                    class="flex-1 py-5 px-8 bg-gradient-to-r from-pink-500 to-purple-600 text-white font-bold text-xl rounded-2xl hover:shadow-2xl transition transform hover:scale-105">
                    <i class="fas fa-paper-plane mr-3"></i> Đăng bài
                </button>
                <a href="{{ url_for('home') }}"
                    class="flex-1 py-5 px-8 bg-gray-200 text-gray-700 font-bold text-xl rounded-2xl text-center hover:bg-gray-300 transition">
                    Hủy bỏ
                </a>
            </div>
        </form>
    </div>
</div>

<script>
function previewMedia(input) {
    const preview = document.getElementById('media-preview');
    preview.innerHTML = '';
    const files = input.files;

    for (let file of files) {
        const div = document.createElement('div');
        div.className = 'relative group';

        if (file.type.startsWith('image/')) {
            const img = document.createElement('img');
            img.src = URL.createObjectURL(file);
            img.className = 'w-full h-48 object-cover rounded-xl shadow-lg';
            div.appendChild(img);
        } else if (file.type.startsWith('video/')) {
            const video = document.createElement('video');
            video.src = URL.createObjectURL(file);
            video.controls = true;
            video.className = 'w-full h-48 object-cover rounded-xl shadow-lg';
            div.appendChild(video);

            const overlay = document.createElement('div');
            overlay.className = 'absolute inset-0 bg-black bg-opacity-40 rounded-xl flex items-center justify-center opacity-0 group-hover:opacity-100 transition';
            overlay.innerHTML = '<i class="fas fa-play-circle text-white text-5xl"></i>';
            div.appendChild(overlay);
        }

        preview.appendChild(div);
    }
}
</script>
{% endblock %}