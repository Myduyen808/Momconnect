<!-- templates/admin/partials/posts.html -->
<div class="mb-4">
    <h2 class="text-2xl font-bold text-gray-800 mb-4">Quản lý Bài viết & Bình luận</h2>
    <div class="flex justify-between mb-4">
        <input type="text" id="searchPost" placeholder="Tìm theo tiêu đề hoặc tác giả..." class="px-4 py-2 border rounded-lg w-96"
               onkeyup="filterPosts()">
        <span class="text-gray-600">Tổng: <strong>{{ posts|length }}</strong> bài viết</span>
    </div>
</div>

<div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tiêu đề</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tác giả</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ngày đăng</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bình luận</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Trạng thái</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hành động</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200" id="postsTable">
            {% for post in posts %}
            <tr class="hover:bg-gray-50">
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                    <a href="javascript:void(0)" onclick="openPostModal({{post.id}}, '{{post.title|replace('\'','\\\'') }}', '{{post.content|replace('\'','\\\'')|replace('\n','\\n') }}', '{{post.author.name}}', '{{post.created_at.strftime('%d/%m/%Y %H:%M') }}', {{post.is_locked|lower}}, {{post.comments|length}})" class="text-pink-600 hover:underline">
                        {{ post.title[:60] }}{% if post.title|length > 60 %}...{% endif %}
                    </a>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{{ post.author.name }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{{ post.created_at.strftime('%d/%m %H:%M') }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{{ post.comments|length }}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    {% if post.is_locked %}
                        <span class="text-red-600 font-bold">Đã khóa</span>
                    {% else %}
                        <span class="text-green-600">Bình thường</span>
                    {% endif %}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                    <button onclick="toggleLock({{post.id}}, {{post.is_locked|lower}})" 
                            class="text-yellow-600 hover:text-yellow-800">
                        {% if post.is_locked %}Mở khóa{% else %}Khóa{% endif %}
                    </button>
                    <button onclick="deletePost({{post.id}})" class="text-red-600 hover:text-red-800">Xóa</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Modal chi tiết bài viết -->
<div id="postDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-screen overflow-y-auto">
        <div class="p-6">
            <div class="flex justify-between items-start mb-4">
                <h3 class="text-2xl font-bold" id="modal_title"></h3>
                <button onclick="closePostModal()" class="text-gray-500 hover:text-gray-800">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <p class="text-gray-600 mb-2">Tác giả: <span id="modal_author"></span> | Ngày đăng: <span id="modal_date"></span></p>
            <p class="text-gray-600 mb-4">Trạng thái: <span id="lock_status"></span> | Bình luận: <span id="modal_comment_count"></span></p>
            
            <div class="border-t pt-4 mb-6">
                <div id="modal_content" class="prose max-w-none"></div>
            </div>

            <h4 class="font-bold text-lg mb-3">Bình luận</h4>
            <div id="comments_list" class="space-y-3"></div>

            <div class="mt-6 flex justify-end space-x-3">
                <button onclick="closePostModal()" class="px-6 py-2 bg-gray-300 rounded-lg hover:bg-gray-400">Đóng</button>
                <input type="hidden" id="modal_post_id">
            </div>
        </div>
    </div>
</div>

<script>
    function filterPosts() {
        const query = document.getElementById('searchPost').value.toLowerCase();
        const rows = document.querySelectorAll('#postsTable tr');
        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(query) ? '' : 'none';
        });
    }
</script>